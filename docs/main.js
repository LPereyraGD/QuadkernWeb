import{QuadKernEffects as e}from"./effects";import{QuadKernNavigation as t}from"./navigation";import{QuadKernPerformance as i}from"./performance";import{rateLimiter as n}from"./security/rateLimiter";import{logger as o}from"./utils/logger";class s{constructor(e={}){this.effects=null,this.navigation=null,this.performance=null,this.isInitialized=!1,this.config={enableEffects:!0,enableNavigation:!0,enablePerformance:!0,enableSecurity:!0,debugMode:!1,autoOptimize:!0,...e},this.init()}async init(){if(!this.isInitialized)try{if(o.log("Initializing QuadKern Application..."),this.config.enableSecurity&&!n.checkRateLimit())return o.warn("Rate limit exceeded, applying restrictions"),void this.enableExtremePerformanceMode();this.config.enablePerformance&&(this.performance=new i,await this.performance.init()),this.config.enableNavigation&&(this.navigation=new t),this.config.enableEffects&&(this.effects=new e),this.config.autoOptimize&&this.setupAutoOptimizations(),this.config.debugMode&&this.setupDebugMode(),this.setupGlobalEvents(),this.isInitialized=!0,o.log("QuadKern Application initialized successfully!"),this.reportInitialMetrics()}catch(e){o.error("Error initializing QuadKern Application:",e)}}setupAutoOptimizations(){const e=/Mobi|Android/i.test(navigator.userAgent),t=4>navigator.deviceMemory,i=navigator.hardwareConcurrency||4;2>navigator.deviceMemory||2>i?(document.documentElement.classList.add("performance-mode-extreme"),this.effects&&(this.effects.setIntensity(.2),this.effects.setSpeed(.3)),this.performance&&this.performance.enableLowPowerMode()):(e||t)&&(document.documentElement.classList.add("low-power-mode"),this.effects&&(this.effects.setIntensity(.6),this.effects.setSpeed(.8)),this.performance&&this.performance.enableLowPowerMode());const n=navigator.connection;!n||"slow-2g"!==n.effectiveType&&"2g"!==n.effectiveType||this.effects&&(this.effects.setIntensity(.3),this.effects.setSpeed(.5)),"getBattery"in navigator&&navigator.getBattery().then(e=>{.2>e.level&&this.enablePowerSavingMode()})}setupDebugMode(){window.QuadKernDebug={effects:this.effects,navigation:this.navigation,performance:this.performance,config:this.config,toggleEffects:()=>this.effects?.toggleEffects(),setEffectIntensity:e=>this.effects?.setIntensity(e),navigateTo:e=>this.navigation?.navigateTo(e),getMetrics:()=>this.performance?.getMetrics(),setScrollEasing:e=>this.navigation?.setEasingType(e),setScrollVelocity:e=>this.navigation?.setScrollVelocity(e),setScrollDuration:e=>this.navigation?.setScrollDuration(e),stopScrolling:()=>this.navigation?.stopScrolling(),enableHighPerformance:()=>this.performance?.enableHighPerformanceMode(),enableLowPower:()=>this.performance?.enableLowPowerMode(),enablePowerSaving:()=>this.enablePowerSavingMode(),help:()=>{}}}setupGlobalEvents(){let e;document.addEventListener("visibilitychange",()=>{document.hidden?this.pauseEffects():this.resumeEffects()}),window.addEventListener("resize",()=>{clearTimeout(e),e=window.setTimeout(()=>{this.handleResize()},250)}),window.addEventListener("error",e=>{this.handleError(e.error)}),window.addEventListener("unhandledrejection",e=>{this.handleError(e.reason)})}pauseEffects(){this.effects&&this.effects.pause()}resumeEffects(){this.effects&&this.effects.resume()}handleResize(){this.navigation&&this.navigation.updateConfig({}),this.effects&&this.effects.resize()}handleError(e){this.config.debugMode,this.attemptRecovery()}attemptRecovery(){try{this.effects&&this.effects.setIntensity(.5),this.enablePowerSavingMode()}catch(e){}}enablePowerSavingMode(){this.effects&&(this.effects.setIntensity(.4),this.effects.setSpeed(.6)),this.performance&&this.performance.enableLowPowerMode(),document.documentElement.classList.add("low-power-mode")}enableExtremePerformanceMode(){this.effects&&(this.effects.setIntensity(.1),this.effects.setSpeed(.2)),this.performance&&this.performance.enableLowPowerMode(),document.documentElement.classList.add("performance-mode-extreme")}reportInitialMetrics(){this.config.debugMode&&((new Date).toISOString(),navigator.userAgent,window.innerWidth,window.innerHeight,window.devicePixelRatio,navigator.hardwareConcurrency,navigator.deviceMemory,navigator.platform,navigator.userAgent,navigator.connection&&(navigator.connection.effectiveType,navigator.connection.downlink,navigator.connection.saveData),this.effects,this.navigation,this.performance)}getEffects(){return this.effects}getNavigation(){return this.navigation}getPerformance(){return this.performance}updateConfig(e){this.config={...this.config,...e},void 0!==e.debugMode&&(e.debugMode?this.setupDebugMode():delete window.QuadKernDebug)}destroy(){this.effects&&this.effects.destroy(),this.isInitialized=!1}}let a=null;document.addEventListener("DOMContentLoaded",()=>{const e="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname;a=new s({enableEffects:!0,enableNavigation:!0,enablePerformance:!0,debugMode:e,autoOptimize:!0}),window.QuadKern=a});export{s as QuadKernApp};export default s;